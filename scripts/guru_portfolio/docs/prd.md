# 주식 대가의 분기별 포트폴리오 변화에 블로그 작성 자동화

## 목적

주식 대가의 분기별 포트폴리오 변화를 블로그에 자동으로 작성하는 것을 목표로 합니다. 이를 통해 투자자들이 대가들의 투자 전략을 쉽게 이해하고 참고할 수 있도록 합니다.

## 요구사항

### 1. 블로그 포스팅 자동 생성 기 개발
- 주식 대가의 분기별 포트폴리오의 변화에 대해서 블로그 포스팅할 내용을 자동 생성한다
  - 참고: https://13f.info/
- conf 파일에 입력값을 미리 넣어둔다. 
  - 비교하려는 년도 & 분기 (ex. Berkshire Hathaway, 2025 Q1 vs 2024 Q4)
  - 여러 회사가 있는 경우에는 별도 폴더에 md 파일로 작성을 한다. 

#### Config 파일 구조
```yaml
# config.yaml 예시
companies:
  - name: "Berkshire Hathaway Inc"
    quarters:
      current: "2025 Q1"
      previous: "2024 Q4"
  - name: "ARK Invest"
    quarters:
      current: "2025 Q1"
      previous: "2024 Q4"

output:
  base_dir: "blog_posts"
  image_format: "png"
  language: "ko"
```

### 2. 목차
블로그에 필요한 내용은 다음과 같다. 

- 1. 개요
  - 입력할 내용: 해당 회사의 CEO 의 이미지 사진을 넣는다
    - CEO 이미지는 구글 이미지 검색을 통해 5개의 후보를 찾아 사용자에게 보여주고 선택하도록 한다
    - 선택한 이미지는 로컬에 저장하여 사용한다
    - 이 사람이 어떤 분인지 간단하게 5 줄 정도로 설명한다
- 2. ####년 #분기 포트폴리오
  - 2.1 현재 포트폴리오
    - 2.1.1 Top Holidings
      - 입력할 내용: Pie Chart 와 Top holings by Weight Chart를 먼저 보여주고 이 차트에 대해서 간단하게 주요 내용만 언급한다. 
    - 2.1.2 섹터별 
      - 입력할 내용: 주식 비중이 섹터별로 어떻게 되는지 Table, Pie chart로 보여주고 내용에 대해서도 요약을 해줘
    - 2.1.3 전체 포트폴리오 목록
      - 입력할 내용: 테이블 형태로 입력한다 (숫자, 티커, 회사명, 섹터, 비중, 보유총금액, 보유 주식 수, 비고-어떤 회사인지 언급)
      - 티커에 tradingview 링크를 추가해서 클릭시 바로 링크로 갈 수 있도록 한다
      - 테이블 정렬 옵션: 비중순, 알파벳순, 섹터별
      - 변화 표시: 신규(🆕), 증가(📈), 감소(📉), 청산(❌)
      - 숫자 포맷: 천 단위 구분, 퍼센트 소수점 2자리
  - 2.2 포트폴리오 변화에 대한 요약
    - 입력한 내용: 새로 추가한 종목, 비중을 줄인 종목, 추가로 매수한 종모, 청산한 종목을 글 외에도 그래프로 표현할 수 있으면 좋겠다
  - 2.3 S&P500 vs 나스닥 vs #### 성능 비교
    - 입력한 내용: 하나의 chart에 3개의 티커를 비교할 수 있도록 그래프를 생성
    - 비교 기간: 최근 1년 or 설정 가능한 기간
    - 포트폴리오 성능 계산 방법 명시 필요
    - 리스크 지표 추가 (변동성, 샤프 비율 등)
    - 주의: 13F는 분기별 스냅샷이므로 실제 수익률과 차이 있음
- 3. 마무리
  - 입력할 내용: 포트폴리오의 변화를 요약하고 이 회사는 어디에 집중을 하고 있고 왜 이런 선택을 했는지에 대한 내용을 작성한다

### 3. SEO 최적화
- 제목: "[회사명] [연도] [분기] 포트폴리오 분석"
- 메타 설명 자동 생성
- 키워드 자동 추출
- Open Graph 태그 지원

## 데이터 제약사항
- 13F 보고서는 분기 종료 후 45일 이내에 제출되므로, 최신 분기 데이터가 없을 수 있음
- 포트폴리오 변화 비교는 두 분기의 13F 데이터가 모두 있어야 가능
- $100M 이상의 포지션만 보고되므로 소규모 투자는 포함되지 않음

## 에러 처리 및 예외 상황
- 데이터를 가져올 수 없는 경우 (회사명 오류, 분기 데이터 없음)
- CEO 이미지 검색 실패 시 기본 이미지 사용 또는 이미지 없이 진행
- 이전 분기 데이터가 없어 비교가 불가능한 경우
- API 한도 초과 시 처리 방법
- 구글 이미지 검색 API 한도 또는 오류 처리

## 차트 디자인 가이드라인
- 일관된 색상 팔레트 사용
- 차트 크기: 1200x800px (고해상도)
- 폰트: 한글 지원 폰트 사용
- 워터마크 또는 출처 표시

## 구현 지침

- 코드는 python으로 작성을 한다
- 블로그 생성시 아래 폴더/파일 이름 패턴으로 생성을 한다
  - index.md (markdown 포멧)
  - 폴더 이름은 회사명으로 생성
  - 이미지는 같은 폴더에 둔다
- 블로그 내용은 한글로 작성한다
- AI 사용이 필요하면 OpenAI를 사용하고 API KEY는 OS 환경변수를 사용한다
- 그래프 생성시 plotly library를 사용하고 png 이미지로 생성한다
- 사전 테스트 코드는 modules 폴더에 일단 작성을 해두었다

### 기술 스택
- Python 3.8+
- 필수 라이브러리:
  - pandas: 데이터 처리
  - plotly: 차트 생성
  - yfinance: 주가 데이터
  - beautifulsoup4: 웹 스크래핑
  - requests: HTTP 요청
  - Pillow: CEO 이미지 처리
  - pyyaml: config 파일 처리
  - jinja2: 템플릿 엔진 (마크다운 생성용)
  - openai: AI 텍스트 생성
  - google-api-python-client: 구글 이미지 검색 (또는 대체 방법)

### CEO 이미지 검색 구현 방안
1. **Google Custom Search API 사용 (권장)**
   - API 키 필요 (환경변수로 관리)
   - 일일 검색 한도: 100회 (무료)
   - "[회사명] CEO" 키워드로 검색

2. **대체 방안**
   - Bing Image Search API
   - Web scraping (법적 제약 확인 필요)
   - 사전 구축된 CEO 이미지 데이터베이스 활용

3. **사용자 인터페이스**
   - 터미널에서 이미지 URL 5개 표시
   - 번호 선택 방식 (1-5)
   - 선택한 이미지 다운로드 및 저장
   - 이미지 크기 자동 조정 (400x400px)

## 선택적 추가 기능
- 소셜 미디어 공유용 요약 이미지 생성
- 포트폴리오 변화 알림 (임계값 설정)

## 테스트 요구사항
- 기능 하나씩 개발하면서 잘 구현이 되었는지 테스트로 확인한다
- 단위 테스트 작성
- 통합 테스트 시나리오
- 에러 케이스 테스트